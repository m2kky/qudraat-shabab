# نظام Access Token - دليل الاستخدام

## 🎯 نظرة عامة

تم تطوير نظام Access Token قوي وآمن لإدارة الوصول إلى لوحة التحكم. بدلاً من نظام المستخدمين التقليدي، يستخدم النظام **Access Tokens** قوية (24 حرف) مع صلاحيات محددة.

## 🔑 المميزات

- **Access Tokens قوية**: 24 حرف مع أحرف كبيرة وصغيرة وأرقام ورموز خاصة
- **صلاحيات محددة**: read, write, delete, admin
- **انتهاء صلاحية اختياري**: يمكن تعيين مدة صلاحية للـ Tokens
- **تتبع الاستخدام**: عدد مرات الاستخدام وآخر استخدام
- **إدارة مركزية**: إنشاء وإدارة Tokens من لوحة التحكم

## 🚀 البدء السريع

### 1. إنشاء Master Token

```bash
# تشغيل السكريبت لإنشاء Master Token
node create-master-token.js
```

### 2. تحديث قواعد Firestore

1. اذهب إلى [Firebase Console](https://console.firebase.google.com)
2. اختر مشروعك
3. اذهب إلى **Firestore > Rules**
4. استبدل القواعد الحالية بمحتوى ملف `firestore-rules-token.txt`

### 3. تسجيل الدخول

1. اذهب إلى: `http://localhost:5173/token-login`
2. أدخل الـ Master Token الذي تم إنشاؤه
3. اضغط "تسجيل الدخول"

## 📋 أنواع الصلاحيات

| الصلاحية | الوصف |
|---------|-------|
| `read` | قراءة البيانات فقط |
| `write` | قراءة وكتابة البيانات |
| `delete` | قراءة وكتابة وحذف البيانات |
| `admin` | صلاحيات كاملة + إدارة Tokens |

## 🛠️ إدارة Access Tokens

### إنشاء Token جديد

1. اذهب إلى لوحة التحكم
2. اضغط على تبويب **"إدارة Access Tokens"**
3. اضغط **"إنشاء Token جديد"**
4. املأ البيانات:
   - **اسم الـ Token**: اسم وصفي
   - **الوصف**: وصف الاستخدام
   - **الصلاحيات**: اختر الصلاحيات المطلوبة
   - **مدة الصلاحية**: (اختياري) عدد الأيام
5. اضغط **"إنشاء"**
6. **احفظ الـ Token** في مكان آمن!

### إدارة Tokens موجودة

- **تفعيل/تعطيل**: تغيير حالة الـ Token
- **تعديل**: تغيير الاسم والوصف والصلاحيات
- **حذف**: حذف الـ Token نهائياً
- **نسخ**: نسخ الـ Token للاستخدام

## 🔒 الأمان

### نصائح الأمان

1. **احفظ Tokens في مكان آمن**
2. **لا تشارك Tokens مع أشخاص غير مصرح لهم**
3. **استخدم مدة صلاحية للـ Tokens المؤقتة**
4. **عطل Tokens غير المستخدمة**
5. **راقب استخدام Tokens**

### حماية البيانات

- **قراءة عامة**: الأحداث والمدربين والمعرض
- **كتابة مقيدة**: تحتاج Token مع صلاحية `write` أو `admin`
- **إدارة Tokens**: تحتاج صلاحية `admin` فقط
- **التسجيلات**: أي شخص يمكنه التسجيل، القراءة للإدمن فقط

## 📁 هيكل الملفات

```
src/
├── components/
│   ├── auth/
│   │   ├── TokenAuthProvider.jsx    # نظام المصادقة بـ Token
│   │   └── TokenProtectedRoute.jsx  # حماية الصفحات
│   └── admin/
│       └── TokensManagement.jsx     # إدارة Access Tokens
├── pages/
│   └── TokenLogin.jsx               # صفحة تسجيل الدخول
├── utils/
│   └── tokenGenerator.js            # مولد Tokens
└── firebase/
    └── config.js                    # إعدادات Firebase
```

## 🔧 استكشاف الأخطاء

### خطأ "Permission Denied"

**السبب**: قواعد Firestore لا تسمح بالوصول

**الحل**:
1. تأكد من تحديث قواعد Firestore
2. استخدم القواعد من ملف `firestore-rules-token.txt`
3. تأكد من أن الـ Token له الصلاحيات المطلوبة

### خطأ "Token غير صحيح"

**السبب**: الـ Token غير موجود أو معطل

**الحل**:
1. تأكد من كتابة الـ Token بشكل صحيح
2. تحقق من أن الـ Token نشط
3. تحقق من انتهاء الصلاحية

### خطأ "غير مصرح لك بالوصول"

**السبب**: الـ Token لا يملك الصلاحية المطلوبة

**الحل**:
1. تحقق من صلاحيات الـ Token
2. اطلب من المدير تحديث الصلاحيات
3. استخدم Token مع صلاحيات أعلى

## 📞 الدعم

إذا واجهت أي مشاكل:

1. تحقق من ملف `ACCESS_TOKEN_SYSTEM.md`
2. راجع رسائل الخطأ في Console
3. تأكد من إعدادات Firebase
4. تحقق من قواعد Firestore

## 🎉 مبروك!

الآن لديك نظام Access Token قوي وآمن لإدارة الوصول إلى لوحة التحكم. استمتع بالاستخدام! 🚀
